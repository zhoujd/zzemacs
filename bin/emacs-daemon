#!/bin/bash

## https://www.emacswiki.org/emacs/EmacsAsDaemon
## https://emacsredux.com/blog/2020/07/16/running-emacs-with-systemd
## systemctl --user list-units --type service
## Add Chinese input method support
## Environment=SSH_AUTH_SOCK=%t/keyring/ssh LANG=en_US.UTF-8 GTK_IM_MODULE=ibus QT_IM_MODULE=ibus XMODIFIERS="@im=ibus"
## sed -i '/Environment/ s/$/ LANG=en_US.UTF-8 GTK_IM_MODULE=ibus QT_IM_MODULE=ibus XMODIFIERS="@im=ibus"/' ~/.config/systemd/user/emacs.service
## systemctl --user daemon-reload
## systemctl --user restart emacs.service

install() {
    echo "Install emacs daemon"
    systemctl --user enable --now emacs
}

uninstall() {
    echo "Uninstall emacs daemon"
    systemctl --user disable --now emacs
}

stop() {
    echo "Stop emacs daemon"
    systemctl --user stop --now emacs
}

start() {
    echo "Start emacs daemon"
    systemctl --user start --now emacs
}

restart() {
    echo "Restart emacs daemon"
    stop
    start
}

status() {
    echo "Status of emacs daemon"
    systemctl status --user emacs
    ps -ef | grep emacs | grep daemon | grep -v emacs-daemon

}

case $1 in
    install )
        install
        ;;
    uninstall )
        uninstall
        ;;
    start )
        start
        ;;
    stop )
        stop
        ;;
    restart )
        restart
        ;;
    status )
        status
        ;;
    * )
        echo "Usage: $(basename $0) {install|uninstall|start|stop|restart|status}"
        ;;
esac
