#!/bin/bash

if [ "$OS" = "Windows_NT" ] ; then
    SCRIPT_HOME=$(cd $(dirname $0) && pwd -W)
    ZZEMACS_ROOT=$(cd $SCRIPT_HOME/.. && pwd -W)
else
    # get script path
    script_path() 
    {
        SOURCE=${BASH_SOURCE[0]}
        DIR=$( dirname "$SOURCE" )
        while [ -h "$SOURCE" ]
        do
            SOURCE=$(readlink "$SOURCE")
            [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
            DIR=$( cd -P "$( dirname "$SOURCE"  )" && pwd )
        done
        DIR=$( cd -P "$( dirname "$SOURCE" )" && pwd )
        echo $DIR
    }

    SCRIPT_HOME=$(script_path)
    ZZEMACS_ROOT=$(cd $SCRIPT_HOME/.. && pwd)
fi

# reorganize parameters
pre_params=
post_params=$@
nw_check=`echo $@ | grep -e '\(-nw\)\|\(--no-window-system\)'`

if [ ! -z "$nw_check" ] ; then
    pre_params="--no-window-system"
    post_params=`echo $@ | sed -e 's/\(-nw\)\|\(--no-window-system\)//g'`
fi

emacs --quick $pre_params \
      --eval "(setq zzemacs-path \"${ZZEMACS_ROOT}\")" \
      --eval "(load-file \"${ZZEMACS_ROOT}/.emacs\")"  \
      --eval "(message \"start emacs finished.\")"     \
      $post_params
