#!/bin/bash
#set -x

SCRIPT_ROOT=$(cd $(dirname "${BASH_SOURCE[0]}") && pwd)
TAGS_ROOT=$HOME/.emacs.d/tags
PROJ_LIST=(
    /usr/include
    /usr/local/include
    $*
)

create_init() {
    echo "create init..."
    mkdir -p $TAGS_ROOT
    rm -f $TAGS_ROOT/TAGS
    rm -f $TAGS_ROOT/cscope.*
}

create_etags() {
    echo "create etags to $TAG_ROOT..."
    pushd $TAGS_ROOT > /dev/null
    find ${PROJ_LIST[*]} $* -type f    \
         \( -name "*.[chCH]"  \
         -o -name "*.cc"      \
         -o -name "*.[ch]xx"  \
         -o -name "*.[ch]pp"  \
         -o -name "*.CC"      \
         -o -name "*.HH"      \
         -o -name "*.[ch]++"  \
         \) -print | etags -
    popd > /dev/null
}

create_cscope() {
    echo "create cscope to $TAG_ROOT..."
    pushd $TAGS_ROOT > /dev/null
    find ${PROJ_LIST[*]} $* -type f    \
         \( -name "*.[chCH]"  \
         -o -name "*.cc"      \
         -o -name "*.[ch]xx"  \
         -o -name "*.[ch]pp"  \
         -o -name "*.CC"      \
         -o -name "*.HH"      \
         -o -name "*.[ch]++"  \
         \) -print > cscope.files;

    cscope -b -R -q -i cscope.files
    popd > /dev/null
}

case $1 in
    -h|--help )
        echo "Usage: $(basename $0) {dir1} {dir2} ... {dirN}"
        ;;
    * )
        create_init
        create_etags
        create_cscope
        ;;
esac
